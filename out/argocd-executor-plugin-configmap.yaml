# This is an auto-generated file. DO NOT EDIT
apiVersion: v1
data:
  sidecar.container: |
    args:
    - "import json\nfrom http.server import BaseHTTPRequestHandler, HTTPServer\nfrom pprint
      import pprint\n\nclass Plugin(BaseHTTPRequestHandler):\n\n    def args(self):\n
      \       return json.loads(self.rfile.read(int(self.headers.get('Content-Length'))))\n\n
      \   def reply(self, reply):\n        self.send_response(200)\n        self.end_headers()\n
      \       self.wfile.write(json.dumps(reply).encode(\"UTF-8\"))\n\n    def error(self,
      message: str):\n        self.reply({\n            'node': {\n                'phase':
      'Error', \n                'message': str.format(\"ArgoCD executor plugin error:
      {}\", message),\n            }\n        })\n\n    def success(self, message: str,
      outputs: list = None):\n        ret_val = {\n            'node': {\n                'phase':
      'Succeeded', \n                'message': str.format(\"ArgoCD executor plugin succeeded:
      {}\", message),\n            }\n        }\n\n        if outputs is not None:\n            ret_val['node'][\"outputs\"]
      = { 'parameters': outputs }\n\n        self.reply(ret_val)\n\n    def fail(self,
      message: str):\n        self.reply({\n            'node': {\n                'phase':
      'Failed', \n                'message': str.format(\"ArgoCD executor plugin failed:
      {}\", message),\n            }\n        })\n\n    def do_POST(self):\n        print(\"Started!\")\n\n
      \       if self.path != '/api/v1/template.execute':\n            self.send_response(404)\n
      \           self.end_headers()\n            return\n\n        args = self.args()\n
      \       pprint(args)\n\n        if 'argocd' not in args['template'].get('plugin',
      {}):\n            self.reply({})\n            return\n\n        self.success(\"synced
      app\")\n\n\nif __name__ == '__main__':\n    httpd = HTTPServer(('', 4355), Plugin)\n
      \   httpd.serve_forever()\n"
    command:
    - python
    - -c
    image: python:alpine
    name: argocd-executor-plugin
    ports:
    - containerPort: 4355
    resources:
      limits:
        cpu: 200m
        memory: 64Mi
      requests:
        cpu: 100m
        memory: 32Mi
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      runAsUser: 1000
kind: ConfigMap
metadata:
  annotations:
    workflows.argoproj.io/description: |
      This is an ArgoCD plugin that allows you to interact with an argocd instance of your choice

      Example:

      ```yaml
      apiVersion: argoproj.io/v1alpha1
      kind: Workflow
      metadata:
        generateName: argocd-example-
      spec:
        entrypoint: main
        templates:
          - name: main
            plugin:
              argocd:
                serverUrl: https://my-argocd-instance.com/
                actions:
                  - sync:
                      project: default
                      app: guestbook
                  - refresh:
                      project: default
                      app: guestbook
      ```
    workflows.argoproj.io/version: '>= v3.3'
  creationTimestamp: null
  labels:
    workflows.argoproj.io/configmap-type: ExecutorPlugin
  name: argocd-executor-plugin
